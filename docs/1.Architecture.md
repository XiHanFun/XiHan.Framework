# XiHan.Framework 架构

XiHan.Framework 的包架构，专为前后端分离的 ASP.NET Core 应用设计。框架基于 .NET 9，优先使用原生功能，减少第三方依赖，确保模块化、可扩展和易用性。命名空间根据项目类型区分：

- **XiHan.Framework.[ModuleName]**: 通用类库，使用 `Microsoft.NET.Sdk`。
- **XiHan.Framework.Web.[ModuleName]**: Web 相关功能，使用 `Microsoft.NET.Sdk.Web`。

## 设计原则

- **分层架构**：遵循清晰的分层原则，避免循环依赖，确保架构的可维护性。
- **依赖倒置**：高层模块不依赖低层模块，都依赖抽象接口。
- **单一职责**：每个包只负责一个特定的功能领域。
- **开闭原则**：对扩展开放，对修改关闭，通过接口和抽象类支持自定义。
- **优先 .NET 9**：使用内置功能（如 DI、日志、序列化），仅在必要时兼容第三方库。
- **国内外环境**：提供中文文档，兼容国际标准（OpenAPI、gRPC）。
- **性能优化**：利用 .NET 9 AOT 编译和高性能特性，提供性能基准数据。
- **快速启动**：确保用户下载后即可运行完整的 Web API 项目，快速体验框架功能。

## 架构分层

```
┌─────────────────────────────────────────────────────────────┐
│                    Presentation Layer                       │
│              (XiHan.Framework.Web.*)                       │
├─────────────────────────────────────────────────────────────┤
│                    Application Layer                        │
│              (XiHan.Framework.Application)                 │
├─────────────────────────────────────────────────────────────┤
│                     Domain Layer                            │
│              (XiHan.Framework.Domain)                      │
├─────────────────────────────────────────────────────────────┤
│                  Infrastructure Layer                       │
│    (XiHan.Framework.Data, Caching, Security, etc.)        │
├─────────────────────────────────────────────────────────────┤
│                     Core Layer                              │
│              (XiHan.Framework.Core)                        │
└─────────────────────────────────────────────────────────────┘
```

## 包依赖层次

### 第 0 层：元数据包

- **XiHan.Framework** （无依赖）

### 第 1 层：框架基础

- **XiHan.Framework.Core** （依赖：XiHan.Framework）
- **XiHan.Framework.Utils** （依赖：XiHan.Framework）

### 第 2 层：核心服务

- **XiHan.Framework.Serialization** （依赖：Core）
- **XiHan.Framework.Logging** （依赖：Core）
- **XiHan.Framework.Domain** （依赖：Core）
- **XiHan.Framework.ObjectMapping** （依赖：Core）
- **XiHan.Framework.Validation** （依赖：Core）
- **XiHan.Framework.Security** （依赖：Core）
- **XiHan.Framework.Threading** （依赖：Core）
- **XiHan.Framework.DistributedIds** （依赖：Core）
- **XiHan.Framework.Web.Core** （依赖：Core）

### 第 3 层：应用和基础设施

- **XiHan.Framework.Application** （依赖：Core, Serialization）
- **XiHan.Framework.Data** （依赖：Core, Domain）
- **XiHan.Framework.Uow** （依赖：Core）
- **XiHan.Framework.Caching** （依赖：Core, Serialization）
- **XiHan.Framework.Authentication** （依赖：Security）
- **XiHan.Framework.Messaging** （依赖：Core, Serialization）
- **XiHan.Framework.Http** （依赖：Core, Serialization）
- **XiHan.Framework.BackgroundJobs** （依赖：Core）
- **XiHan.Framework.Templating** （依赖：Core, Serialization）
- **XiHan.Framework.VirtualFileSystem** （依赖：Core, Authentication）
- **XiHan.Framework.SearchEngines** （依赖：Core, Serialization）
- **XiHan.Framework.Localization** （依赖：Core, Web.Core）
- **XiHan.Framework.AI** （依赖：Core, Serialization）
- **XiHan.Framework.Script** （依赖：Core, Serialization）

### 第 4 层：高级功能

- **XiHan.Framework.Authorization** （依赖：Authentication）
- **XiHan.Framework.EventBus** （依赖：Core, Messaging）
- **XiHan.Framework.Web.Api** （依赖：Web.Core, Application）
- **XiHan.Framework.CodeGeneration** （依赖：Core, Templating）
- **XiHan.Framework.Bot** （依赖：Core, Serialization, Http）

### 第 5 层：应用级服务

- **XiHan.Framework.Settings** （依赖：Data）
- **XiHan.Framework.MultiTenancy** （依赖：Data, Settings, Authentication）
- **XiHan.Framework.Web.Docs** （依赖：Web.Api）
- **XiHan.Framework.Web.RealTime** （依赖：Web.Core, Authentication）
- **XiHan.Framework.Web.Gateway** （依赖：Web.Core, Authentication）

### 第 6 层：开发工具

- **XiHan.Framework.DevTools** （依赖：Core）

---

## 第 0 层：元数据包

**XiHan.Framework**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 框架元数据和基础配置。
- **详细描述**: 包含框架版本信息等，为所有其他包提供基础支持。
- **依赖**: 无（元数据包）。

**基本功能：**

- 框架版本信息 (`XiHan`)
- 基础配置类 (`XiHanFrameworkOptions`)
- 框架常量定义 (`XiHanFrameworkConstants`)
- 基础接口定义 (`IXiHanFramework`)

## 第 1 层：框架基础

**XiHan.Framework.Core**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供框架核心工具、依赖注入、模块化支持。
- **详细描述**: 包含通用扩展方法、基类和配置管理工具，集成 .NET 9 内置 DI，支持服务注册与解析，模块化设计，提升开发效率。
- **依赖**: XiHan.Framework（元数据包）。

**基本功能：**

- 依赖注入扩展 (`ServiceCollectionExtensions`)
- 模块化系统 (`IModule`, `ModuleBase`, `ModuleManager`)
- 配置管理 (`IConfigurationManager`, `AppSettings`)
- 基础异常类 (`XiHanException`, `BusinessException`)
- 通用结果类 (`Result<T>`, `PagedResult<T>`)
- 基础接口 (`IEntity`, `IAuditedEntity`)
- 服务定位器 (`IServiceLocator`)
- 应用生命周期管理 (`IApplicationLifecycle`)
- 领域事件基础 (`IDomainEvent`, `DomainEventBase`)
- 值对象基础 (`ValueObject<T>`)

**XiHan.Framework.Utils**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供通用工具和扩展方法。
- **详细描述**: 包含字符串处理、日期时间操作、加密解密、反射工具等实用方法，简化日常开发任务。
- **依赖**: XiHan.Framework（元数据包）。

**基本功能：**

- 字符串扩展方法 (`StringExtensions`)
- 日期时间工具 (`DateTimeUtils`, `TimeSpanExtensions`)
- 加密解密工具 (`EncryptionUtils`, `HashUtils`)
- 反射工具 (`ReflectionUtils`, `TypeExtensions`)
- 集合扩展方法 (`CollectionExtensions`, `EnumerableExtensions`)
- 文件操作工具 (`FileUtils`, `PathUtils`)
- 随机数生成器 (`RandomUtils`)
- 验证工具 (`ValidationUtils`)

## 第 2 层：核心服务

### 序列化和日志

**XiHan.Framework.Serialization**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 支持对象序列化和反序列化。
- **详细描述**: 基于 System.Text.Json 提供高效 JSON 序列化，支持自定义转换器，兼容 Newtonsoft.Json。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- JSON 序列化服务 (`IJsonSerializer`, `SystemTextJsonSerializer`)
- 自定义转换器 (`DateTimeJsonConverter`, `EnumJsonConverter`)
- 序列化配置 (`SerializationOptions`)
- 二进制序列化 (`IBinarySerializer`)
- XML 序列化 (`IXmlSerializer`)
- 序列化扩展方法 (`SerializationExtensions`)

**XiHan.Framework.Logging**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 统一日志记录与管理。
- **详细描述**: 基于 .NET 9 日志框架，支持结构化日志、多目标输出（如文件、控制台），兼容 Serilog 等扩展库。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 日志配置 (`LoggingExtensions`, `LoggingOptions`)
- 结构化日志 (`StructuredLogger`, `ILoggerExtensions`)
- 日志中间件 (`RequestLoggingMiddleware`, `PerformanceLoggingMiddleware`)
- 日志格式化 (`LogFormatter`, `JsonLogFormatter`)
- 日志级别管理 (`LogLevelManager`)
- 日志上下文 (`LogContext`, `CorrelationIdMiddleware`)
- 日志过滤器 (`LogFilter`, `LogFilterExtensions`)

### 领域驱动设计

**XiHan.Framework.Domain**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供领域驱动设计的基础设施。
- **详细描述**: 包含领域实体、聚合根、领域服务、领域事件、值对象、领域枚举、常量、异常等核心概念，为复杂业务系统提供完整的领域建模支持。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 聚合根 (`IAggregateRoot`, `AggregateRoot`)
- 领域实体 (`IDomainEntity`, `DomainEntity`)
- 领域服务 (`IDomainService`, `DomainService`)
- 领域事件 (`IDomainEvent`, `DomainEvent`)
- 领域仓储接口 (`IDomainRepository<T>`)
- 领域配置 (`DomainOptions`)
- 领域扩展 (`DomainExtensions`)
- 领域验证 (`IDomainValidator`, `DomainValidator`)
- 领域规则 (`IDomainRule`, `DomainRuleBase`)
- 领域策略 (`IDomainStrategy`, `DomainStrategyBase`)
- 值对象 (`ValueObject<T>`, `SingleValueObject<T>`)
- 领域枚举 (`DomainEnum`, `DomainEnumExtensions`)
- 领域常量 (`DomainConstants`)
- 领域异常 (`DomainException`, `BusinessRuleException`)
- 领域事件基类 (`DomainEventBase`)
- 领域接口 (`IDomainObject`)

### 对象映射和数据验证

**XiHan.Framework.ObjectMapping**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供对象映射和转换功能。
- **详细描述**: 支持 Entity ↔ DTO 转换，集成 Mapster 或 AutoMapper，提供高性能对象映射，支持自定义映射规则和配置。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 对象映射服务 (`IObjectMapper`, `ObjectMapper`)
- 映射配置 (`MappingConfiguration`, `TypeAdapterConfig`)
- 映射扩展 (`ObjectMapperExtensions`)
- 自动映射 (`IAutoMapper`, `AutoMapperService`)
- 映射验证 (`IMappingValidator`, `MappingValidator`)
- 映射缓存 (`IMappingCache`, `MappingCache`)
- 映射监控 (`IMappingMonitor`, `MappingMonitor`)
- 映射工具 (`MappingUtils`, `TypeAdapter`)

**XiHan.Framework.Validation**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 支持数据输入验证。
- **详细描述**: 基于数据注解和 FluentValidation，提供模型验证和自定义规则，保障输入数据的可靠性。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 验证扩展 (`ValidationExtensions`, `ModelValidationExtensions`)
- 自定义验证特性 (`CustomValidationAttribute`, `RequiredIfAttribute`)
- FluentValidation 集成 (`FluentValidationExtensions`)
- 验证结果 (`ValidationResult`, `ValidationError`)
- 验证中间件 (`ValidationMiddleware`)
- 验证规则 (`IValidationRule`, `ValidationRuleBase`)
- 验证配置 (`ValidationOptions`)

### 安全基础

**XiHan.Framework.Security**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供安全相关的基础功能。
- **详细描述**: 包含加密解密、哈希算法、数字签名等安全工具，为认证授权提供基础支持。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 加密服务 (`IEncryptionService`, `AesEncryptionService`)
- 哈希服务 (`IHashService`, `Sha256HashService`)
- 数字签名 (`IDigitalSignatureService`)
- 安全工具 (`SecurityUtils`, `PasswordUtils`)
- 安全配置 (`SecurityOptions`)
- 安全中间件 (`SecurityMiddleware`)
- 安全扩展 (`SecurityExtensions`)

### 系统工具

**XiHan.Framework.Threading**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供线程安全和异步编程工具。
- **详细描述**: 包含锁机制、线程池管理、异步任务调度等功能，优化多线程应用开发。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 异步锁 (`IAsyncLock`, `AsyncLock`)
- 线程池管理 (`IThreadPoolManager`, `ThreadPoolManager`)
- 异步任务调度 (`IAsyncTaskScheduler`, `AsyncTaskScheduler`)
- 并发控制 (`IConcurrencyControl`, `ConcurrencyControl`)
- 线程安全工具 (`ThreadSafeUtils`, `AtomicOperations`)
- 异步扩展 (`AsyncExtensions`)
- 任务管理 (`ITaskManager`, `TaskManager`)
- 性能监控 (`IPerformanceMonitor`, `PerformanceMonitor`)

**XiHan.Framework.DistributedIds**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 生成分布式唯一 ID。
- **详细描述**: 实现雪花算法（Snowflake）或其他 ID 生成策略，确保分布式系统中 ID 唯一性。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- ID 生成器接口 (`IIdGenerator`, `IDistributedIdGenerator`)
- 雪花算法 (`ISnowflakeIdGenerator`, `SnowflakeIdGenerator`)
- UUID 生成器 (`IUuidGenerator`, `UuidGenerator`)
- ID 配置 (`IdGeneratorOptions`, `SnowflakeOptions`)
- ID 扩展 (`IdGeneratorExtensions`)
- ID 验证 (`IIdValidator`, `IdValidator`)
- ID 格式化 (`IIdFormatter`, `IdFormatter`)
- ID 服务 (`IIdService`, `IdService`)

### Web 基础

**XiHan.Framework.Web.Core**

- **SDK**: Microsoft.NET.Sdk.Web
- **简要功能**: 支持 Web 应用的基础配置和运行时环境。
- **详细描述**: 提供 ASP.NET Core 的 WebHost 和 Kestrel 配置，简化中间件管道设置，适用于快速搭建 Web 项目。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- ASP.NET Core WebHost 配置 (`WebHostBuilderExtensions`)
- Kestrel 服务器配置 (`KestrelOptions`)
- 中间件管道配置 (`MiddlewareExtensions`)
- 基础 Web 应用启动逻辑 (`WebApplicationExtensions`)
- 通用 Web 中间件 (`ExceptionHandlingMiddleware`, `RequestLoggingMiddleware`)
- 健康检查 (`HealthCheckExtensions`)
- 跨域配置 (`CorsExtensions`)

## 第 3 层：应用和基础设施

### 应用层架构

**XiHan.Framework.Application**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供应用服务层的基础设施和通用功能。
- **详细描述**: 实现 CQRS 模式、应用服务基类、DTO 基类、查询对象、应用服务接口、契约定义等，为业务应用提供完整统一的应用层架构。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization。

**基本功能：**

- 应用服务基类 (`ApplicationServiceBase`, `IApplicationService`)
- CQRS 实现 (`ICommand`, `IQuery<T>`, `ICommandHandler<T>`, `IQueryHandler<T, TResult>`)
- 命令总线 (`ICommandBus`, `CommandBus`)
- 查询总线 (`IQueryBus`, `QueryBus`)
- DTO 基类 (`DtoBase`, `CreateDtoBase`, `UpdateDtoBase`)
- 查询对象 (`IPagedQuery`, `ISortedQuery`, `IFilteredQuery`)
- 应用服务配置 (`ApplicationOptions`)
- 应用服务扩展 (`ApplicationServiceExtensions`)
- 应用服务验证 (`IApplicationServiceValidator`)
- 应用服务监控 (`IApplicationServiceMonitor`)
- 应用服务接口 (`IUserAppService`, `IProductAppService`)
- DTO 定义 (`UserDto`, `CreateUserDto`, `UpdateUserDto`)
- 查询对象接口 (`IGetUsersQuery`, `ISearchUsersQuery`)
- 应用服务事件 (`IApplicationServiceEvent`)
- 应用服务配置接口 (`IApplicationServiceConfiguration`)
- 应用服务验证接口 (`IApplicationServiceValidation`)

**XiHan.Framework.Data**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供数据访问和 ORM 工具。
- **详细描述**: 集成 Entity Framework Core、SqlSugar 和 Dapper，支持迁移、仓储模式和数据操作，适用于多种数据库场景。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Domain。

**基本功能：**

- 数据库上下文 (`IDbContext`, `XiHanDbContext`)
- 仓储实现 (`Repository<T>`, `EfCoreRepository<T>`)
- 数据迁移 (`IMigrationService`, `MigrationExtensions`)
- 查询构建器 (`IQueryBuilder`, `QueryBuilder`)
- 数据过滤器 (`IDataFilter`, `DataFilterExtensions`)
- 数据库配置 (`DatabaseOptions`, `ConnectionStringManager`)
- 数据审计 (`IAuditService`, `AuditExtensions`)
- 数据种子 (`IDataSeeder`, `DataSeederExtensions`)

**XiHan.Framework.Uow**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供工作单元（Unit of Work）模式实现。
- **详细描述**: 实现完整的工作单元模式，管理事务边界、数据库连接和事务行为，支持嵌套工作单元、事务回滚和事件发布，确保数据一致性。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 工作单元管理 (`IUnitOfWork`, `UnitOfWork`, `IUnitOfWorkManager`)
- 环境工作单元 (`IAmbientUnitOfWork`, `AmbientUnitOfWork`)
- 数据库 API (`IDatabaseApi`, `IDatabaseApiContainer`)
- 事务管理 (`ITransactionApi`, `ITransactionApiContainer`)
- 工作单元特性 (`UnitOfWorkAttribute`, `IUnitOfWorkEnabled`)
- 事件发布 (`IUnitOfWorkEventPublisher`, `UnitOfWorkEventArgs`)
- 事务行为 (`UnitOfWorkTransactionBehavior`, `IUnitOfWorkTransactionBehaviourProvider`)
- 工作单元拦截器 (`UnitOfWorkInterceptor`, `UnitOfWorkInterceptorRegistrar`)
- 子工作单元 (`ChildUnitOfWork`)
- 工作单元选项 (`XiHanUnitOfWorkOptions`, `IXiHanUnitOfWorkOptions`)

**XiHan.Framework.Caching**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 优化应用缓存管理。
- **详细描述**: 支持内存缓存和分布式缓存（如 Redis），支持分级缓存、缓存优先级、缓存统计、缓存策略、缓存淘汰策略、缓存预热，提升性能和响应速度。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization。

**基本功能：**

- 缓存服务 (`ICacheService`, `MemoryCacheService`)
- 分布式缓存 (`IDistributedCacheService`, `RedisCacheService`)
- 缓存管理器 (`ICacheManager`, `CacheManager`)
- 缓存配置 (`CacheOptions`, `RedisOptions`)
- 缓存中间件 (`CacheMiddleware`)
- 缓存扩展 (`CacheExtensions`)
- 缓存统计 (`ICacheStatistics`, `CacheStatistics`)
- 缓存预热 (`ICacheWarmup`, `CacheWarmupService`)

**XiHan.Framework.VirtualFileSystem**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 管理文件存储和访问。
- **详细描述**: 支持本地文件系统、云存储（如 AWS S3），提供文件上传、下载和权限控制。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Authentication。

**基本功能：**

- 文件系统服务 (`IFileSystemService`, `FileSystemService`)
- 文件存储提供者 (`IFileStorageProvider`, `LocalFileStorageProvider`, `S3FileStorageProvider`)
- 文件配置 (`FileSystemOptions`, `StorageOptions`)
- 文件扩展 (`FileSystemExtensions`)
- 文件上传 (`IFileUploadService`, `FileUploadService`)
- 文件下载 (`IFileDownloadService`, `FileDownloadService`)
- 文件权限 (`IFilePermissionService`, `FilePermissionService`)
- 文件监控 (`IFileMonitor`, `FileMonitor`)

**XiHan.Framework.SearchEngines**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供全文搜索和索引功能。
- **详细描述**: 集成 Elasticsearch，支持高效搜索、数据索引和查询优化，适用于搜索密集型应用。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization。

**基本功能：**

- 搜索引擎服务 (`ISearchEngineService`, `ElasticsearchService`)
- 索引管理 (`IIndexManager`, `IndexManager`)
- 搜索配置 (`SearchOptions`, `ElasticsearchOptions`)
- 搜索扩展 (`SearchExtensions`)
- 查询构建器 (`IQueryBuilder`, `SearchQueryBuilder`)
- 搜索结果 (`ISearchResult<T>`, `SearchResult<T>`)
- 搜索监控 (`ISearchMonitor`, `SearchMonitor`)
- 搜索缓存 (`ISearchCache`, `SearchCache`)

### 身份认证

**XiHan.Framework.Authentication**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 实现用户身份认证功能。
- **详细描述**: 支持 JWT、OAuth 2.0 和 OpenID Connect，集成 ASP.NET Core Identity，提供登录、令牌生成与验证功能。
- **依赖**: XiHan.Framework.Security。

**基本功能：**

- JWT 服务 (`IJwtService`, `JwtService`)
- 认证服务 (`IAuthenticationService`, `AuthenticationService`)
- 用户管理 (`IUserService`, `UserManager`)
- 令牌管理 (`ITokenService`, `TokenManager`)
- 认证中间件 (`AuthenticationMiddleware`)
- 认证配置 (`AuthenticationOptions`, `JwtOptions`)
- 认证扩展 (`AuthenticationExtensions`)
- 登录处理 (`ILoginService`, `LoginService`)

### 通信和消息

**XiHan.Framework.Messaging**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 支持消息队列与事件驱动开发。
- **详细描述**: 兼容 RabbitMQ 和 Kafka，提供消息发布与订阅机制，助力构建高扩展性事件驱动系统。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization。

**基本功能：**

- 消息服务 (`IMessageService`, `MessageService`)
- 消息发布者 (`IMessagePublisher`, `MessagePublisher`)
- 消息订阅者 (`IMessageSubscriber`, `MessageSubscriber`)
- 消息配置 (`MessageOptions`, `RabbitMQOptions`, `KafkaOptions`)
- 消息中间件 (`MessageMiddleware`)
- 消息扩展 (`MessageExtensions`)
- 消息序列化 (`IMessageSerializer`, `MessageSerializer`)
- 消息监控 (`IMessageMonitor`, `MessageMonitor`)

**XiHan.Framework.Http**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 封装 HTTP 客户端。
- **详细描述**: 基于 HttpClientFactory，提供重试、超时、认证等功能，简化外部 API 调用。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization。

**基本功能：**

- HTTP 客户端 (`IHttpClient`, `XiHanHttpClient`)
- HTTP 配置 (`HttpOptions`, `HttpClientOptions`)
- 重试策略 (`IRetryPolicy`, `RetryPolicy`)
- HTTP 中间件 (`HttpMiddleware`, `HttpLoggingMiddleware`)
- HTTP 扩展 (`HttpExtensions`)
- 请求构建器 (`IHttpRequestBuilder`, `HttpRequestBuilder`)
- 响应处理器 (`IHttpResponseHandler`, `HttpResponseHandler`)
- HTTP 监控 (`IHttpMonitor`, `HttpMonitor`)

### 系统服务

**XiHan.Framework.BackgroundJobs**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 管理后台任务和定时作业。
- **详细描述**: 集成 Hangfire 或 Quartz.NET，支持异步任务队列和定时调度，提供任务监控和管理功能。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 后台任务服务 (`IBackgroundJobService`, `BackgroundJobService`)
- 任务调度器 (`IJobScheduler`, `JobScheduler`)
- 任务配置 (`BackgroundJobOptions`, `HangfireOptions`, `QuartzOptions`)
- 任务中间件 (`BackgroundJobMiddleware`)
- 任务扩展 (`BackgroundJobExtensions`)
- 任务监控 (`IJobMonitor`, `JobMonitor`)
- 任务存储 (`IJobStorage`, `JobStorage`)
- 任务队列 (`IJobQueue`, `JobQueue`)

**XiHan.Framework.Templating**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 支持文本模板生成。
- **详细描述**: 集成 RazorLight 或 Scriban，提供动态模板渲染，用于邮件、报告和代码生成。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization。

**基本功能：**

- 模板引擎 (`ITemplateEngine`, `RazorTemplateEngine`, `ScribanTemplateEngine`)
- 模板服务 (`ITemplateService`, `TemplateService`)
- 模板配置 (`TemplateOptions`, `RazorOptions`, `ScribanOptions`)
- 模板扩展 (`TemplateExtensions`)
- 模板缓存 (`ITemplateCache`, `TemplateCache`)
- 模板编译 (`ITemplateCompiler`, `TemplateCompiler`)
- 模板监控 (`ITemplateMonitor`, `TemplateMonitor`)
- 模板验证 (`ITemplateValidator`, `TemplateValidator`)

**XiHan.Framework.Localization**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 支持国际化与本地化。
- **详细描述**: 基于 .NET 9 的 `IStringLocalizer` 和资源文件（`.resx`）实现多语言支持，支持动态语言切换和本地化中间件，适用于多语言应用。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Web.Core。

**基本功能：**

- 本地化服务 (`ILocalizationService`, `LocalizationService`)
- 字符串本地化器 (`IStringLocalizer`, `StringLocalizer`)
- 本地化配置 (`LocalizationOptions`)
- 本地化中间件 (`LocalizationMiddleware`)
- 本地化扩展 (`LocalizationExtensions`)
- 资源管理器 (`IResourceManager`, `ResourceManager`)
- 文化信息 (`ICultureService`, `CultureService`)
- 本地化缓存 (`ILocalizationCache`, `LocalizationCache`)

### 扩展功能

**XiHan.Framework.AI**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 集成 AI 和机器学习功能。
- **详细描述**: 提供 ML.NET 或 TensorFlow.NET 集成，支持模型训练、推理和智能推荐。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization。

**基本功能：**

- AI 服务 (`IAIService`, `AIService`)
- 机器学习模型 (`IMLModel`, `MLModel`)
- AI 配置 (`AIOptions`, `MLNetOptions`)
- AI 扩展 (`AIExtensions`)
- 模型训练 (`IModelTrainer`, `ModelTrainer`)
- 模型推理 (`IModelInference`, `ModelInference`)
- 智能推荐 (`IRecommendationService`, `RecommendationService`)
- AI 监控 (`IAIMonitor`, `AIMonitor`)

**XiHan.Framework.Script**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供脚本执行和动态代码运行能力。
- **详细描述**: 支持 JavaScript、Python 等脚本语言集成，提供脚本引擎、动态编译和脚本管理功能，适用于规则引擎和动态业务逻辑。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization。

**基本功能：**

- 脚本引擎 (`IScriptEngine`, `JavaScriptEngine`, `PythonEngine`)
- 脚本服务 (`IScriptService`, `ScriptService`)
- 脚本配置 (`ScriptOptions`, `JavaScriptOptions`, `PythonOptions`)
- 脚本扩展 (`ScriptExtensions`)
- 脚本缓存 (`IScriptCache`, `ScriptCache`)
- 脚本编译 (`IScriptCompiler`, `ScriptCompiler`)
- 脚本监控 (`IScriptMonitor`, `ScriptMonitor`)
- 脚本验证 (`IScriptValidator`, `ScriptValidator`)

## 第 4 层：高级功能

### 权限授权

**XiHan.Framework.Authorization**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供权限管理和访问控制。
- **详细描述**: 支持角色、策略和声明的授权方式，与认证模块无缝协作，实现资源保护和权限校验。
- **依赖**: XiHan.Framework.Authentication。

**基本功能：**

- 授权服务 (`IAuthorizationService`, `AuthorizationService`)
- 角色管理 (`IRoleService`, `RoleManager`)
- 权限管理 (`IPermissionService`, `PermissionManager`)
- 策略管理 (`IPolicyService`, `PolicyManager`)
- 授权中间件 (`AuthorizationMiddleware`)
- 授权特性 (`AuthorizeAttribute`, `PermissionAttribute`)
- 授权配置 (`AuthorizationOptions`)
- 授权扩展 (`AuthorizationExtensions`)

### 事件处理

**XiHan.Framework.EventBus**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 支持事件总线和发布/订阅模式。
- **详细描述**: 提供本地和分布式事件处理，支持 MediatR、RabbitMQ，解耦业务逻辑。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Messaging。

**基本功能：**

- 事件总线 (`IEventBus`, `EventBus`)
- 事件发布者 (`IEventPublisher`, `EventPublisher`)
- 事件订阅者 (`IEventSubscriber`, `EventSubscriber`)
- 事件处理器 (`IEventHandler<T>`, `EventHandler<T>`)
- 事件配置 (`EventBusOptions`)
- 事件扩展 (`EventBusExtensions`)
- 事件中间件 (`EventBusMiddleware`)
- 事件监控 (`IEventMonitor`, `EventMonitor`)

### Web API 开发

**XiHan.Framework.Web.Api**

- **SDK**: Microsoft.NET.Sdk.Web
- **简要功能**: 助力 RESTful API 开发与管理。
- **详细描述**: 提供控制器基类、路由管理和模型绑定，支持 OpenAPI、System.Text.Json、API 版本控制，优化 API 开发体验。
- **依赖**: XiHan.Framework.Web.Core, XiHan.Framework.Application。

**基本功能：**

- 控制器基类 (`XiHanController`, `ApiControllerBase`)
- API 路由管理 (`RouteExtensions`, `ApiRouteBuilder`)
- 模型绑定配置 (`ModelBindingExtensions`)
- API 版本控制 (`ApiVersioningExtensions`, `VersionedApiController`)
- RESTful API 最佳实践 (`ApiResponse<T>`, `ApiResult`)
- API 响应格式化 (`ResponseFormatter`, `ApiResponseFormatter`)
- 错误处理中间件 (`ApiExceptionMiddleware`, `GlobalExceptionHandler`)
- 请求验证 (`RequestValidationMiddleware`)
- CQRS 控制器 (`CommandController`, `QueryController`)

### 代码生成

**XiHan.Framework.CodeGeneration**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 自动生成代码。
- **详细描述**: 基于 T4 模板或 Roslyn，生成实体、DTO、控制器等代码，减少重复劳动。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Templating。

**基本功能：**

- 代码生成器 (`ICodeGenerator`, `CodeGenerator`)
- 代码模板 (`ICodeTemplate`, `CodeTemplate`)
- 代码配置 (`CodeGenerationOptions`)
- 代码扩展 (`CodeGenerationExtensions`)
- 代码分析 (`ICodeAnalyzer`, `CodeAnalyzer`)
- 代码格式化 (`ICodeFormatter`, `CodeFormatter`)
- 代码验证 (`ICodeValidator`, `CodeValidator`)
- 代码监控 (`ICodeMonitor`, `CodeMonitor`)

### 机器人集成

**XiHan.Framework.Bot**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供多平台消息机器人集成。
- **详细描述**: 支持 Telegram、WhatsApp、企业微信、钉钉、飞书、Email、SMS 等多种消息平台，提供统一的机器人 API 和消息处理机制，适用于客服、通知、自动化等场景。
- **依赖**: XiHan.Framework.Core, XiHan.Framework.Serialization, XiHan.Framework.Http。

**基本功能：**

- 机器人服务 (`IBotService`, `BotService`)
- 消息平台适配器 (`IMessagePlatformAdapter`, `TelegramAdapter`, `WhatsAppAdapter`, `WeChatAdapter`, `DingTalkAdapter`, `FeishuAdapter`, `EmailAdapter`, `SmsAdapter`)
- 消息处理器 (`IMessageHandler`, `MessageHandler`)
- 机器人配置 (`BotOptions`, `TelegramOptions`, `WhatsAppOptions`, `WeChatOptions`, `DingTalkOptions`, `FeishuOptions`, `EmailOptions`, `SmsOptions`)
- 消息模板 (`IMessageTemplate`, `MessageTemplate`)
- 机器人扩展 (`BotExtensions`)
- 消息监控 (`IMessageMonitor`, `MessageMonitor`)
- 机器人管理 (`IBotManager`, `BotManager`)

## 第 5 层：应用级服务

### 配置管理

**XiHan.Framework.Settings**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 管理应用配置和设置。
- **详细描述**: 支持动态配置、数据库存储配置、租户级设置等，灵活控制应用行为。
- **依赖**: XiHan.Framework.Data。

**基本功能：**

- 设置服务 (`ISettingService`, `SettingService`)
- 设置管理器 (`ISettingManager`, `SettingManager`)
- 动态配置 (`IDynamicConfiguration`, `DynamicConfiguration`)
- 设置存储 (`ISettingStore`, `DatabaseSettingStore`)
- 设置配置 (`SettingOptions`)
- 设置扩展 (`SettingExtensions`)
- 设置验证 (`ISettingValidator`, `SettingValidator`)
- 设置缓存 (`ISettingCache`, `SettingCache`)

### 多租户架构

**XiHan.Framework.MultiTenancy**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 支持多租户架构。
- **详细描述**: 提供租户隔离策略、租户解析中间件和租户管理 API，支持数据和配置的租户级隔离，适用于 SaaS 应用。
- **依赖**: XiHan.Framework.Data, XiHan.Framework.Settings, XiHan.Framework.Authentication。

**基本功能：**

- 租户服务 (`ITenantService`, `TenantService`)
- 租户解析器 (`ITenantResolver`, `TenantResolver`)
- 租户中间件 (`TenancyMiddleware`)
- 租户配置 (`MultiTenancyOptions`)
- 租户扩展 (`MultiTenancyExtensions`)
- 租户隔离 (`ITenantIsolation`, `TenantIsolation`)
- 租户管理 (`ITenantManager`, `TenantManager`)
- 租户监控 (`ITenantMonitor`, `TenantMonitor`)

### API 文档

**XiHan.Framework.Web.Docs**

- **SDK**: Microsoft.NET.Sdk.Web
- **简要功能**: 生成 API 文档和客户端代码。
- **详细描述**: 集成 Swashbuckle 和 Scalar，支持交互式 OpenAPI 文档生成和客户端代码（如 TypeScript SDK）输出，方便开发与集成。
- **依赖**: XiHan.Framework.Web.Api。

**基本功能：**

- Swagger/OpenAPI 集成 (`SwaggerExtensions`, `OpenApiExtensions`)
- API 文档生成 (`DocumentationGenerator`, `ApiDocumentationService`)
- 客户端代码生成 (`ClientCodeGenerator`, `TypeScriptGenerator`)
- API 测试工具 (`ApiTestClient`, `ApiTestExtensions`)
- 文档配置 (`SwaggerOptions`, `OpenApiOptions`)

### 实时通信

**XiHan.Framework.Web.RealTime**

- **SDK**: Microsoft.NET.Sdk.Web
- **简要功能**: 实现实时 Web 通信。
- **详细描述**: 基于 ASP.NET Core SignalR，支持消息推送、实时通知和双向通信，适用于聊天、动态更新等场景。
- **依赖**: XiHan.Framework.Web.Core, XiHan.Framework.Authentication。

**基本功能：**

- SignalR 服务 (`ISignalRService`, `SignalRService`)
- 实时通信配置 (`RealTimeOptions`, `SignalROptions`)
- 实时通信中间件 (`RealTimeMiddleware`)
- 实时通信扩展 (`RealTimeExtensions`)
- 消息推送 (`IMessagePushService`, `MessagePushService`)
- 实时通知 (`IRealTimeNotificationService`, `RealTimeNotificationService`)
- 连接管理 (`IConnectionManager`, `ConnectionManager`)
- 实时监控 (`IRealTimeMonitor`, `RealTimeMonitor`)

### API 网关

**XiHan.Framework.Web.Gateway**

- **SDK**: Microsoft.NET.Sdk.Web
- **简要功能**: 实现 API 网关。
- **详细描述**: 基于 Ocelot 或 YARP，提供路由、负载均衡、认证等功能，管理微服务 API（可选模块）。
- **依赖**: XiHan.Framework.Web.Core, XiHan.Framework.Authentication。

**基本功能：**

- 网关服务 (`IGatewayService`, `GatewayService`)
- 路由管理 (`IRouteManager`, `RouteManager`)
- 负载均衡 (`ILoadBalancer`, `LoadBalancer`)
- 网关配置 (`GatewayOptions`, `OcelotOptions`, `YarpOptions`)
- 网关中间件 (`GatewayMiddleware`)
- 网关扩展 (`GatewayExtensions`)
- 服务发现 (`IServiceDiscovery`, `ServiceDiscovery`)
- 网关监控 (`IGatewayMonitor`, `GatewayMonitor`)

## 第 6 层：开发工具

**XiHan.Framework.DevTools**

- **SDK**: Microsoft.NET.Sdk
- **简要功能**: 提供开发与调试工具集。
- **详细描述**: 包含 xUnit 测试框架、Moq 模拟工具和性能监控功能，助力开发、测试和问题排查。
- **依赖**: XiHan.Framework.Core。

**基本功能：**

- 测试基类 (`TestBase`, `IntegrationTestBase`)
- 模拟工具 (`MockExtensions`, `TestDataBuilder`)
- 性能监控 (`IPerformanceMonitor`, `PerformanceMonitor`)
- 调试工具 (`IDebugService`, `DebugService`)
- 开发配置 (`DevToolsOptions`)
- 测试扩展 (`TestExtensions`)
- 性能分析 (`IPerformanceAnalyzer`, `PerformanceAnalyzer`)
- 代码覆盖率 (`ICodeCoverage`, `CodeCoverage`)

---

## 前后端分离支持

- **XiHan.Framework.Web.Docs** 生成 OpenAPI 或 gRPC 客户端代码，支持 React、Vue、Angular 等前端框架。
- **XiHan.Framework.Web.Api** 和 **XiHan.Framework.Web.RealTime** 提供高效 API 和实时通信，简化前后端协作。

## 开发和发布流程

1. **项目结构**
   - 通用功能使用 `Microsoft.NET.Sdk`，命名为 `XiHan.Framework.[ModuleName]`。
   - Web 功能使用 `Microsoft.NET.Sdk.Web`，命名为 `XiHan.Framework.Web.[ModuleName]`。
2. **打包**  
   使用 `dotnet pack` 创建 NuGet 包，配置正确元数据（版本、描述、依赖）。
3. **发布**  
   在 NuGet.org 发布，支持预发布版本（如 `1.0.0-beta`）。
4. **版本管理**  
   遵循语义化版本控制（SemVer），同步所有包版本。
5. **CI/CD**  
   使用 GitHub Actions 自动化构建、测试和发布。

## 示例项目

提供 GitHub/Gitee 托管的示例项目，展示包的使用：

- **快速启动项目**：使用最小包集合 (`XiHan.Framework.Web.Api`, `XiHan.Framework.Web.Docs`) 创建可运行的 Web API。
- **完整 RESTful API**：`XiHan.Framework.Web.Api`, `XiHan.Framework.Data`, `XiHan.Framework.Authentication`。
- **认证和授权**：`XiHan.Framework.Authentication`, `XiHan.Framework.Authorization`。
- **实时通信**：`XiHan.Framework.Web.RealTime`。
- **监控和日志**：`XiHan.Framework.DevTools`, `XiHan.Framework.Logging`。
- **国际化与本地化**：`XiHan.Framework.Localization`。
- **多租户**：`XiHan.Framework.MultiTenancy`。
- **消息机器人**：`XiHan.Framework.Bot`。
- **脚本执行**：`XiHan.Framework.Script`。

## 注意事项

- **精简依赖**：优先使用 .NET 9 原生功能（如内置 DI、日志、序列化），仅在必要时兼容第三方库（如 Redis、HotChocolate）。
- **国内环境**：提供中文文档，托管在 Gitee，支持国内 NuGet 镜像。
- **国际标准**：支持 OpenAPI、gRPC、Swagger，符合全球开发者习惯。
- **性能优化**：利用 .NET 9 AOT 编译，提供性能基准数据。
- **社区支持**：为每个包提供 GitHub/Gitee 仓库，支持问题反馈和贡献。
- **快速体验**：确保用户使用核心包组合能在 5 分钟内启动完整的 Web API 项目。

## 使用示例

### 快速启动（最小化配置）

```bash
// 添加元数据包（必需）
dotnet add package XiHan.Framework

// 添加 Web API 核心包（快速启动）
dotnet add package XiHan.Framework.Web.Api
dotnet add package XiHan.Framework.Web.Docs
dotnet add package XiHan.Framework.Logging
```

### 完整功能（推荐配置）

```bash
// 添加完整的 Web API 解决方案
dotnet add package XiHan.Framework.Web.Api
dotnet add package XiHan.Framework.Web.Docs
dotnet add package XiHan.Framework.Application
dotnet add package XiHan.Framework.Data
dotnet add package XiHan.Framework.Authentication
dotnet add package XiHan.Framework.Caching
dotnet add package XiHan.Framework.Validation
dotnet add package XiHan.Framework.ObjectMapping
```

### 扩展功能（按需添加）

```bash
// 添加扩展包（按需）
dotnet add package XiHan.Framework.Web.RealTime
dotnet add package XiHan.Framework.BackgroundJobs
dotnet add package XiHan.Framework.Localization
dotnet add package XiHan.Framework.MultiTenancy
dotnet add package XiHan.Framework.Bot
```

## 架构优势

### 1. 清晰的分层架构

- **表现层**：Web API、文档生成、实时通信
- **应用层**：应用服务、CQRS、业务编排
- **领域层**：领域模型、业务规则、领域服务
- **基础设施层**：数据访问、缓存、消息队列、安全等

### 2. 依赖关系清晰

- 遵循依赖倒置原则
- 避免循环依赖
- 清晰的包依赖层次

### 3. 模块化设计

- 每个包职责单一
- 支持按需引用
- 易于扩展和维护

### 4. 符合 DDD 原则

- 应用服务层处理业务编排
- 领域层包含核心业务逻辑
- 基础设施层提供技术实现

### 5. 支持 CQRS 模式

- 命令和查询分离
- 支持读写分离
- 优化查询性能
